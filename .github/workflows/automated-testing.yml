name: Automated Testing and Monitoring

on:
  schedule:
    - cron: '0 */6 * * *'  # Run every 6 hours
  workflow_dispatch:  # Allow manual triggering

jobs:
  performance-testing:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install locust pytest-benchmark memory_profiler

      - name: Run performance tests
        run: |
          python -m pytest tests/performance/ --benchmark-only
          python -m memory_profiler tests/performance/memory_tests.py

      - name: Upload performance results
        uses: actions/upload-artifact@v3
        with:
          name: performance-results
          path: performance_results/

  security-scanning:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run security scan
        uses: snyk/actions/python@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: Run dependency check
        uses: dependency-check/Dependency-Check@main
        with:
          project: 'EntangledMultimodalSystem'
          path: '.'
          format: 'HTML'
          out: 'reports'

      - name: Upload security report
        uses: actions/upload-artifact@v3
        with:
          name: security-report
          path: reports/

  code-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install quality tools
        run: |
          pip install radon mccabe xenon vulture

      - name: Run code quality checks
        run: |
          radon cc . -a
          xenon --max-absolute A --max-modules A --max-average A
          vulture . --min-confidence 80

      - name: Upload quality report
        uses: actions/upload-artifact@v3
        with:
          name: quality-report
          path: quality_reports/

  notify-results:
    needs: [performance-testing, security-scanning, code-quality]
    runs-on: ubuntu-latest
    steps:
      - name: Send notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_CHANNEL: automated-testing
          SLACK_COLOR: ${{ job.status }}
          SLACK_TITLE: Automated Testing Results
          SLACK_MESSAGE: "Automated testing completed. Check artifacts for detailed reports." 